C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE PWLOCK
OBJECT MODULE PLACED IN pwlock.OBJ
COMPILER INVOKED BY: H:\Keil\C51\BIN\C51.EXE pwlock.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <STC15F2K60S2.h>
   2          #include <intrins.h>
   3          #define uint unsigned int
   4          #define uchar unsigned char
   5          
   6          #define ADC_POWER 0x80      /*ADCç”µæºå¼€å…³*/
   7          #define ADC_FLAG 0x10       /*å½“A/Dè½¬æ¢å®Œæˆåï¼ŒADC_FLAGè¦è½¯ä»¶æ¸…é›¶*/
   8          #define ADC_START 0x08      /*å½“A/Dè½¬æ¢å®Œæˆåï¼ŒcstAdcStartä¼šè‡ªåŠ¨æ¸…é›¶ï¼Œæ‰€ä»¥è¦å¼€å§‹ä¸‹ä¸€æ¬
             -¡è½¬æ¢ï¼Œåˆ™éœ€è¦ç½®ä½*/
   9          #define ADC_SPEED_90 0x60   /*ADCè½¬æ¢é€Ÿåº¦ 90ä¸ªæ—¶é’Ÿå‘¨æœŸè½¬æ¢ä¸€æ¬¡*/
  10          #define ADC_CHS1_7 0x07     /*é€‰æ‹©P1.7ä½œä¸ºA/Dè¾“å…¥*/
  11          
  12          
  13          uchar i=0,blink=0;//iç”¨äºå®šæ—¶å™¨ä¸­æ–­å½“ä¸­æ•°ç ç®¡æ‰«æçš„å˜é‡ï¼Œblinkç”¨äº250msåˆ†é¢‘
  14          uchar barCounter=0;//ç”¨äºLEDè¿›åº¦æ¡æ˜¾ç¤ºæ—¶çš„åˆ†é¢‘
  15          uchar barLedCounter=0;//ç”¨äºLEDè¿›åº¦æ¡æ˜¾ç¤ºæ—¶åˆ‡æ¢æ•°ç»„å…ƒç´ 
  16          uchar flagblink=0;//ç”¨äºè®°å½•é—ªçƒä½çš„ç¿»è½¬çŠ¶æ€
  17          uchar flagState=0;//çŠ¶æ€æ ‡å¿—ï¼Œ0ä»£è¡¨é”å®šçŠ¶æ€ï¼Œ1ä»£è¡¨è§£é”çŠ¶æ€ï¼Œ2ä»£è¡¨è®¾å®šå¯†ç çŠ¶æ€
  18          uchar flagBar=0;//ç”¨äºè¿›åº¦æ¡LEDæ˜¾ç¤ºçš„æ ‡å¿—ä½
  19          uchar flagWrong=0;//æ ‡å¿—è¾“é”™å¯†ç 
  20          uchar flagBeep=0;//ç”¨äºæ ‡å¿—èœ‚é¸£å™¨å·¥ä½œ
  21          uchar wrongCounter=0;//ç”¨äºé”™è¯¯æ—¶LEDæ˜¾ç¤ºåˆ†é¢‘
  22          uchar wrongLedCounter=0;//ç”¨äºé”™è¯¯æ—¶é€‰æ‹©LEDæ˜¾ç¤º
  23          uchar segSelect[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f}; //æ®µé€‰ä¿¡å·ï¼Œæ˜¾ç¤º0-9
  24          uchar digSelect[]={0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07};//ä½é€‰ä¿¡å·ï¼Œæ•°ç ç®¡0-7ä½
  25          uchar progressBarLed[] = {0x00, 0x80, 0xc0, 0xe0, 0xf0, 0xf8, 0xfc, 0xfe, 0xff};//LEDè¿›åº¦æ¡
  26          uchar wrongLed[]={0x00,0xaa,0x55};//å¯†ç é”™è¯¯æ—¶çš„ä¸‰ç§LEDæ˜¾ç¤º
  27          uchar segLine=0x40;//æ¨ªæ æ®µé€‰ä¿¡å·
  28          //uchar writePw[8]={0};//å¾…å†™å…¥çš„6ä½å¯†ç ï¼Œä»…æœ‰å6ä¸ªæ•°æ®æœ‰æ•ˆ
  29          uchar readPw[8]={0};//è¯»å–å‡ºçš„6ä½å¯†ç 
  30          uchar pwshow[8]={0x0};//é”å®šçŠ¶æ€æ•°ç ç®¡ä¸Šæ˜¾ç¤ºçš„6ä½å¯†ç 
  31          uchar editBit=2;//å½“å‰ç¼–è¾‘ä½ï¼Œå³å³ä¸‹è§’æœ‰ç‚¹çš„ä½ã€‚
  32          
  33          sbit sbtLedSel = P2 ^ 3;//æ•°ç ç®¡å’ŒLEDåˆ‡æ¢å¼•è„š
  34          sbit sbtBeep = P3 ^ 4;//èœ‚é¸£å™¨å¼•è„š
  35          sbit sbtKey1 = P3 ^ 2;//key1å¼•è„š
  36          sbit sbtKey2 = P3 ^ 3;//key2å¼•è„š
  37          sbit sbtKey3 = P1 ^ 7;//key3å¼•è„š
  38          sbit SDA = P4 ^ 0;//I2Cæ€»çº¿çš„æ•°æ®çº¿
  39          sbit SCL = P5 ^ 5;//I2Cæ€»çº¿çš„æ—¶é’Ÿçº¿
  40          sbit sbtIn =P1 ^ 0;//P1.0å¼•è„šï¼Œè¿æ¥ç»§ç”µå™¨è¾“å…¥ã€‚
  41          
  42          void Delay500ms()   //@11.0592MHz
  43          {
  44   1        unsigned char i, j, k;
  45   1      
  46   1        _nop_();
  47   1        _nop_();
  48   1        i = 22;
  49   1        j = 3;
  50   1        k = 227;
  51   1        do
  52   1        {
  53   2          do
  54   2          {
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 2   

  55   3            while (--k);
  56   3          } while (--j);
  57   2        } while (--i);
  58   1      }
  59          
  60          void Delay100ms()       //@11.0592MHz  å»¶æ—¶100ms
  61          {
  62   1          unsigned char i, j, k;
  63   1          _nop_();
  64   1          _nop_();
  65   1          i = 5;
  66   1          j = 52;
  67   1          k = 195;
  68   1          do
  69   1          {
  70   2              do
  71   2              {
  72   3                  while ( --k );
  73   3              }
  74   2              while ( --j );
  75   2          }
  76   1          while ( --i );
  77   1      }
  78          
  79          void Delay80ms()    //@11.0592MHz
  80          {
  81   1        unsigned char i, j, k;
  82   1      
  83   1        _nop_();
  84   1        _nop_();
  85   1        i = 4;
  86   1        j = 93;
  87   1        k = 155;
  88   1        do
  89   1        {
  90   2          do
  91   2          {
  92   3            while (--k);
  93   3          } while (--j);
  94   2        } while (--i);
  95   1      }
  96          
  97          void Delay10ms()    //@11.0592MHz
  98          {
  99   1        unsigned char i, j;
 100   1      
 101   1        i = 108;
 102   1        j = 145;
 103   1        do
 104   1        {
 105   2          while (--j);
 106   2        } while (--i);
 107   1      }
 108          
 109          void Delay5ms()     //@11.0592MHz  å»¶æ—¶5ms
 110          {
 111   1          unsigned char i, j;
 112   1          i = 54;
 113   1          j = 199;
 114   1          do
 115   1          {
 116   2              while ( --j );
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 3   

 117   2          }
 118   1          while ( --i );
 119   1      }
 120          
 121          void Delay1ms()   //@11.0592MHz
 122          {
 123   1        unsigned char i, j;
 124   1      
 125   1        _nop_();
 126   1        _nop_();
 127   1        _nop_();
 128   1        i = 11;
 129   1        j = 190;
 130   1        do
 131   1        {
 132   2          while (--j);
 133   2        } while (--i);
 134   1      }
 135          
 136          void Delay4us()        //å»¶æ—¶4us
 137          {
 138   1          ;;
 139   1      }
 140          
 141          void Delayms( uint n )
 142          {
 143   1          while( n )
 144   1          {
 145   2              uchar i, j;
 146   2              i = 11;
 147   2              j = 190;
 148   2              do
 149   2              {
 150   3                  while ( --j );
 151   3              }
 152   2              while ( --i );
 153   2              n--;
 154   2          }
 155   1      }
 156          /******************ADCå¯¼èˆªæŒ‰é”®éƒ¨åˆ†***************************/
 157          /**************************************
 158           * å‡½æ•°åï¼šGetADC
 159           * æè¿°  ï¼šè·å¾—ADè½¬æ¢çš„å€¼,æ²¡æœ‰è®¾ç½®A/Dè½¬æ¢ä¸­æ–­ï¼ˆå…·ä½“çœ‹IEã€IPï¼‰
 160           * è¾“å…¥  ï¼šæ— 
 161           * è¾“å‡º  ï¼šADè½¬æ¢çš„ç»“æœ
 162           **************************************/
 163          
 164          uchar GetADC()
 165          {
 166   1        unsigned char result;
 167   1        ADC_CONTR = ADC_POWER | ADC_START | ADC_SPEED_90 | ADC_CHS1_7;//æ²¡æœ‰å°†ADC_FLAGç½®1ï¼Œç”¨äºåˆ¤æ–­A/Dæ˜
             -¯å¦ç»“æŸ
 168   1        _nop_();
 169   1        _nop_();
 170   1        _nop_();
 171   1        _nop_();
 172   1        while(!(ADC_CONTR&ADC_FLAG));//ç­‰å¾…ç›´åˆ°A/Dè½¬æ¢ç»“æŸ
 173   1        ADC_CONTR &= ~ADC_FLAG; //ADC_FLAGEè½¯ä»¶æ¸…0
 174   1        result = ADC_RES; //è·å–ADçš„å€¼
 175   1        return result;    //è¿”å›ADCå€¼
 176   1      }
 177          
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 4   

 178          /********************************
 179           * å‡½æ•°åï¼šNavKeycheck()     
 180           * æè¿°  ï¼šæ£€æµ‹åŠŸèƒ½é”®çš„ä¸Š5ã€ä¸‹2ã€å·¦4ã€å³1ã€ç¡®è®¤é”®3ã€å¼€å…³æŒ‰é”®3ï¼ˆ0ï¼‰ï¼Œæ²¡æŒ‰ä¸‹è
             -¿”å›0x07ï¼Œè¿”å›ç›¸åº”çš„å€¼  (åŒ…å«æ¶ˆæŠ–è¿‡ç¨‹)
 181           * è¾“å…¥  ï¼šæ— 
 182           * è¾“å‡º  ï¼šé”®å¯¹åº”çš„å€¼
 183          ********************************/
 184          uchar NavKeyCheck()
 185          {
 186   1        uchar key;
 187   1        key=GetADC();     //è·å¾—ADCå€¼èµ‹å€¼ç»™key
 188   1        if(key!=255)
 189   1        {
 190   2          Delay1ms();
 191   2          key=GetADC();
 192   2          if(key!=255)    //æŒ‰é”®æ¶ˆæŠ–
 193   2          {
 194   3              key=key&0xE0;//è·å–é«˜3ä½ï¼Œå…¶ä»–ä½æ¸…é›¶
 195   3                key=_cror_(key,5);//å¾ªç¯å³ç§»5ä½
 196   3            return key;
 197   3          }
 198   2        }
 199   1        return 0x07;
 200   1      }
 201          
 202          void NavKey_Process()
 203          {
 204   1          uchar NavKeyCurrent;  //å¯¼èˆªæŒ‰é”®å½“å‰çš„çŠ¶æ€
 205   1          uchar NavKeyPast;     //å¯¼èˆªæŒ‰é”®å‰ä¸€ä¸ªçŠ¶æ€
 206   1      
 207   1          NavKeyCurrent = NavKeyCheck();    //è·å–å½“å‰ADCå€¼
 208   1          if( NavKeyCurrent != 0x07 )       //å¯¼èˆªæŒ‰é”®æ˜¯å¦è¢«æŒ‰ä¸‹ ä¸ç­‰äº0x07è¡¨ç¤ºæœ‰æŒ‰ä¸‹
 209   1          {
 210   2              NavKeyPast = NavKeyCurrent;
 211   2              while( NavKeyCurrent != 0x07 )        //ç­‰å¾…å¯¼èˆªæŒ‰é”®æ¾å¼€
 212   2                  NavKeyCurrent = NavKeyCheck();
 213   2              //æ¾å¼€åå†å¯¹è¾“å…¥çš„ä¿¡å·å¤„ç†
 214   2              switch( NavKeyPast )
 215   2              {
 216   3                  case 0x05 ://å‘ä¸Š
 217   3                      if(pwshow[editBit]==9)
 218   3                          pwshow[editBit]=0;
 219   3                      else
 220   3                          pwshow[editBit]++;
 221   3                      break;
 222   3                  case 0x02 ://å‘ä¸‹
 223   3                      if(pwshow[editBit]==0)
 224   3                          pwshow[editBit]=9;
 225   3                      else
 226   3                          pwshow[editBit]--;
 227   3                      break;
 228   3                  case 0x04 ://å‘å·¦
 229   3                      if(editBit==2)
 230   3                          editBit=7;
 231   3                      else
 232   3                          editBit--;
 233   3                      break;
 234   3                  case 0x01 ://å‘å³
 235   3                      if(editBit==7)
 236   3                          editBit=2;
 237   3                      else
 238   3                          editBit++;
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 5   

 239   3                      break;
 240   3                  case 0x03 ://ä¸­é—´
 241   3                      pwshow[editBit]=0;
 242   3                      break;
 243   3              }
 244   2          }
 245   1      
 246   1          //Delay100ms();
 247   1      }
 248          
 249          
 250          
 251          /**********************éæ˜“å¤±å­˜å‚¨å™¨éƒ¨åˆ†**************************/
 252          void IIC_init()     //I2Cæ€»çº¿åˆå§‹åŒ–
 253          {
 254   1          SCL = 1;
 255   1          Delay4us();
 256   1          SDA = 1;
 257   1          Delay4us();
 258   1      }
 259          
 260          void start()        //ä¸»æœºå¯åŠ¨ä¿¡å·
 261          {
 262   1          SDA = 1;
 263   1          Delay4us();
 264   1          SCL = 1;
 265   1          Delay4us();
 266   1          SDA = 0;
 267   1          Delay4us();
 268   1      }
 269          
 270          void stop()         //åœæ­¢ä¿¡å·
 271          {
 272   1          SDA = 0;
 273   1          Delay4us();
 274   1          SCL = 1;
 275   1          Delay4us();
 276   1          SDA = 1;
 277   1          Delay4us();
 278   1      }
 279          
 280          void respons()      //ä»æœºåº”ç­”ä¿¡å·
 281          {
 282   1          uchar i = 0;
 283   1          SCL = 1;
 284   1          Delay4us();
 285   1          while( SDA == 1 && ( i < 255 ) ) //è¡¨ç¤ºè‹¥åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä»å™¨ä»¶çš„åº”ç­”åˆ™
 286   1              i++;                //ä¸»å™¨ä»¶é»˜è®¤ä»æœŸé—´å·²ç»æ”¶åˆ°æ•°æ®è€Œä¸å†ç­‰å¾…åº”ç­”ä¿¡å·ã€‚
 287   1          SCL = 0;
 288   1          Delay4us();
 289   1      }
 290          
 291          void writebyte( uchar data0 )//å¯¹24C02å†™ä¸€ä¸ªå­—èŠ‚æ•°æ®
 292          {
 293   1          uchar i, temp;
 294   1          temp = data0;
 295   1          for( i = 0; i < 8; i++ )
 296   1          {
 297   2              temp = temp << 1;
 298   2              SCL = 0;
 299   2              Delay4us();
 300   2              SDA = CY;
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 6   

 301   2              Delay4us();
 302   2              SCL = 1;
 303   2              Delay4us();
 304   2          }
 305   1          SCL = 0;
 306   1          Delay4us();
 307   1          SDA = 1;
 308   1          Delay4us();
 309   1      }
 310          uchar readbyte()            //ä»24C02è¯»ä¸€ä¸ªå­—èŠ‚æ•°æ®
 311          {
 312   1          uchar i, k;
 313   1          SCL = 0;
 314   1          Delay4us();
 315   1          SDA = 1;
 316   1          Delay4us();
 317   1          for( i = 0; i < 8; i++ )
 318   1          {
 319   2              SCL = 1;
 320   2              Delay4us();
 321   2              k = ( k << 1 ) | SDA;
 322   2              Delay4us();
 323   2              SCL = 0;
 324   2              Delay4us();
 325   2          }
 326   1          Delay4us();
 327   1          return k;
 328   1      }
 329          
 330          void write_add( uchar addr, uchar data0 ) //å¯¹24C02çš„åœ°å€addrï¼Œå†™å…¥ä¸€ä¸ªæ•°æ®data0
 331          {
 332   1          start();
 333   1          writebyte( 0xa0 );
 334   1          respons();
 335   1          writebyte( addr );
 336   1          respons();
 337   1          writebyte( data0 );
 338   1          respons();
 339   1          stop();
 340   1      }
 341          uchar read_add( uchar addr )      //ä»24C02çš„addråœ°å€ï¼Œè¯»ä¸€ä¸ªå­—èŠ‚æ•°æ®
 342          {
 343   1          uchar data0;
 344   1          start();
 345   1          writebyte( 0xa0 );
 346   1          respons();
 347   1          writebyte( addr );
 348   1          respons();
 349   1          start();
 350   1          writebyte( 0xa1 );
 351   1          respons();
 352   1          data0 = readbyte();
 353   1          stop();
 354   1          return data0;
 355   1      }
 356          
 357          void init()//åˆå§‹åŒ–
 358          {
 359   1          uchar j=0,data0=0x00;;
 360   1          //è®¾å®šP0,P1.0,P2.3,P3.4æ¨æŒ½è¾“å‡º
 361   1          P0M1=0x00;
 362   1          P0M0=0xff;
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 7   

 363   1          P1M1=0x00;
 364   1          P1M0=0x01;
 365   1          P2M1=0x00;
 366   1          P2M0=0x08;
 367   1          P3M1 = 0x00;//èœ‚é¸£å™¨
 368   1          P3M0 = 0x10;
 369   1          
 370   1          //ADä¿¡å·åˆå§‹åŒ–éƒ¨åˆ†
 371   1          P1ASF=0x80;//å°†P1ASFå¯„å­˜å™¨å¯¹åº”ä½ç½®1
 372   1        ADC_RES = 0;//ç»“æœå¯„å­˜å™¨æ¸…é›¶
 373   1          //ADC_RESL=0;
 374   1        ADC_CONTR = ADC_POWER | ADC_FLAG | ADC_START | ADC_SPEED_90 | ADC_CHS1_7;   //å¯¹åº”ä½èµ‹å€¼
 375   1        Delayms(2);
 376   1          
 377   1          /************å®šæ—¶å™¨0è®¾ç½®******************/
 378   1          TMOD=0x01;        //å®šæ—¶å™¨0ï¼Œæ–¹å¼1ã€‚å®šæ—¶å™¨1æ–¹å¼0ï¼Œ16ä½è‡ªåŠ¨é‡è£…ã€‚
 379   1        EA=1;         //æ‰“å¼€æ€»çš„ä¸­æ–­
 380   1        ET0=1;          //å¼€å¯å®šæ—¶å™¨0ä¸­æ–­  
 381   1        TH0=(65535-1000)/256; //è®¾ç½®å®šæ—¶åˆå€¼
 382   1        TL0=(65535-1000)%256;
 383   1        TR0=1;          //å¯åŠ¨å®šæ—¶å™¨
 384   1          /***********å®šæ—¶å™¨1è®¾ç½®******************/
 385   1          AUXR |= 0x40;           //å®šæ—¶å™¨1æ—¶é’Ÿ1Tæ¨¡å¼
 386   1          ET1=1;          //å¼€å¯å®šæ—¶å™¨1ä¸­æ–­
 387   1          TH1 = 0xF4;             //è®¾ç½®å®šæ—¶1åˆå€¼
 388   1          TL1 = 0xCD;             //è®¾ç½®å®šæ—¶1åˆå€¼
 389   1          TF1 = 0;                //æ¸…é™¤TF1æ ‡å¿—
 390   1          TR1 = 1;                //å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶
 391   1      
 392   1          sbtLedSel=0;
 393   1          sbtBeep=0;
 394   1          sbtIn=0;
 395   1          P0=0x00;
 396   1      
 397   1          IIC_init();//IICåˆå§‹åŒ–
 398   1          for(j=0;j<8;j++)//ä»éæ˜“å¤±å­˜å‚¨å™¨ä¸­è¯»å‡ºå¯†ç 
 399   1          {
 400   2              data0=read_add(j);
 401   2              readPw[j]=data0;
 402   2          }
 403   1      
 404   1          /*
 405   1          for(j=0;j<8;j++)
 406   1          {
 407   1              write_add(j,0x08);
 408   1              Delay10ms();
 409   1          }
 410   1          */
 411   1      }
 412          
 413          void timer0() interrupt 1
 414          {
 415   1          TH0=(65535-1000)/256;   //é‡æ–°å¡«å……åˆå€¼
 416   1        TL0=(65535-1000)%256;
 417   1      
 418   1          //NavKey_Process();//è·å–å¯¼èˆªæŒ‰é”®çŠ¶æ€
 419   1          i++;
 420   1          if(i==8)
 421   1              i=0;
 422   1          
 423   1          if(flagState==0)//é”å®šçŠ¶æ€
 424   1          {
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 8   

 425   2              //é”™è¯¯å¤„ç†éƒ¨åˆ†
 426   2              if(flagWrong==1)
 427   2              {
 428   3                  wrongCounter++;
 429   3                  if(wrongCounter==50)
 430   3                      wrongLedCounter=1;
 431   3                  else if(wrongCounter==100)
 432   3                      wrongLedCounter=2;
 433   3                  else if(wrongCounter==150)
 434   3                      wrongLedCounter=1;
 435   3                  else if(wrongCounter==200)
 436   3                      wrongLedCounter=2;
 437   3                  else if(wrongCounter==250)
 438   3                  {
 439   4                      wrongLedCounter=0;//LEDåœæ­¢æ˜¾ç¤º
 440   4                      flagWrong=0;//å…³é—­é”™è¯¯æ ‡å¿—
 441   4                      wrongCounter=0;//é”™è¯¯åˆ†é¢‘å½’0
 442   4                  }
 443   3                  
 444   3              }
 445   2      
 446   2              //æ˜¾ç¤ºéƒ¨åˆ†
 447   2              P0=0;
 448   2              sbtLedSel=0;
 449   2              P2=digSelect[i];
 450   2              if(i<2)//å‰ä¸¤ä½æ˜¾ç¤ºæ¨ªæ 
 451   2                  P0=segLine;
 452   2              else
 453   2              {
 454   3                  if(i==editBit)
 455   3                      P0=segSelect[pwshow[i]] | 0x80;//ç¼–è¾‘ä½åŠ å°æ•°ç‚¹
 456   3                  else
 457   3                      P0=segSelect[pwshow[i]];
 458   3                  //P0=segSelect[i+1];
 459   3              }
 460   2              Delay1ms();
 461   2      
 462   2              if(i==7&&flagWrong==1)
 463   2              {
 464   3                  P0=0;
 465   3                  sbtLedSel=1;
 466   3                  P0=wrongLed[wrongLedCounter];
 467   3                  Delay1ms();
 468   3              }
 469   2              
 470   2      
 471   2          }
 472   1          else if (flagState==1)//è§£é”çŠ¶æ€
 473   1          {
 474   2              if(flagBar==0)//åˆæ¬¡è¿›å…¥è§£é”çŠ¶æ€
 475   2              {
 476   3                  barCounter++;
 477   3                  if (barCounter==20)//åˆ†é¢‘
 478   3                  {
 479   4                      if (barLedCounter==8)//è¿›åº¦æ¡å·²æ˜¾ç¤ºå®Œæ¯•
 480   4                          flagBar=1;//å°†æ ‡å¿—è®¾ä¸º1
 481   4                      else
 482   4                          barLedCounter++;//å¦åˆ™å°±å°†æ˜¾ç¤ºçš„LEDå³ç§»
 483   4                      barCounter=0;
 484   4                  }
 485   3              }
 486   2              
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 9   

 487   2              P0=0;
 488   2              sbtLedSel=0;
 489   2              P2=digSelect[i];
 490   2              P0=segLine;
 491   2              Delay1ms();
 492   2      
 493   2              if(i==7)
 494   2              {
 495   3                  P0=0;
 496   3                  sbtLedSel=1;
 497   3                  P0=progressBarLed[barLedCounter];
 498   3                  Delay1ms();
 499   3              }
 500   2              
 501   2          }
 502   1          else if(flagState==2)//ä¿®æ”¹çŠ¶æ€
 503   1          {
 504   2              blink++;
 505   2              if(blink==100)
 506   2              {
 507   3                  blink=0;
 508   3                  if(flagblink==0)//ç¿»è½¬é—ªçƒçŠ¶æ€
 509   3                      flagblink=1;
 510   3                  else
 511   3                      flagblink=0;
 512   3              }
 513   2      
 514   2              barCounter++;
 515   2              if(barCounter==100)
 516   2              {
 517   3                  barCounter=0;
 518   3                  if(barLedCounter==0)
 519   3                      barLedCounter=8;
 520   3                  else
 521   3                      barLedCounter=0;
 522   3              }
 523   2      
 524   2              P0=0;
 525   2              sbtLedSel=0;
 526   2              P2=digSelect[i];
 527   2              if(i<2)//å‰ä¸¤ä½æ˜¾ç¤ºæ¨ªæ 
 528   2              {
 529   3                  if(flagblink==1)
 530   3                      P0=segLine;
 531   3                  else
 532   3                      P0=0;
 533   3              }
 534   2              else
 535   2              {
 536   3                  if(i==editBit)
 537   3                      P0=segSelect[pwshow[i]] | 0x80;
 538   3                  else
 539   3                      P0=segSelect[pwshow[i]];
 540   3              }
 541   2              Delay1ms();
 542   2      
 543   2              if(i==7)
 544   2              {
 545   3                  P0=0;
 546   3                  sbtLedSel=1;
 547   3                  P0=progressBarLed[barLedCounter];
 548   3                  Delay1ms();
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 10  

 549   3              }
 550   2          }
 551   1          
 552   1          //Delay1ms();
 553   1      }
 554          
 555          void timer1() interrupt 3//å®šæ—¶å™¨1
 556          {
 557   1          if(flagBeep)
 558   1              sbtBeep = ~sbtBeep;//äº§ç”Ÿæ–¹æ³¢ä½¿å¾—èœ‚é¸£å™¨å‘å£°
 559   1          else
 560   1              sbtBeep = 0;//å¦‚æœå¼€å…³å…³é—­,åˆ™èœ‚é¸£å™¨æ–­ç”µä»¥ä¿æŠ¤èœ‚é¸£å™¨
 561   1      }
 562          
 563          void main()
 564          {
 565   1          uchar j=0;//ç”¨äºå†™å…¥æˆ–ä¿®æ”¹æ•°æ®æ—¶åœ¨å¾ªç¯å†…çš„å˜é‡
 566   1          init();
 567   1        while(1)
 568   1          {
 569   2              if(flagState==0)//é”å®šçŠ¶æ€
 570   2              {
 571   3                  NavKey_Process();//è·å–å¹¶å¤„ç†å¯¼èˆªæŒ‰é”®çŠ¶æ€
 572   3                  if(sbtKey1==0)//æ£€æµ‹åˆ°key1æŒ‰ä¸‹
 573   3                  {
 574   4                      Delay5ms();//æ¶ˆæŠ–
 575   4                      if(sbtKey1==0)
 576   4                      {
 577   5                          while( !sbtKey1 );//ç›´åˆ°key1æ¾å¼€
 578   5                          if(pwshow[2]==readPw[2]&&pwshow[3]==readPw[3]&&pwshow[4]==readPw[4]&&
 579   5                          pwshow[5]==readPw[5]&&pwshow[6]==readPw[6]&&pwshow[7]==readPw[7])
 580   5                          {
 581   6                              barCounter=0;//å°†LEDè¿›åº¦æ¡åˆ†é¢‘å˜é‡å½’0
 582   6                              barLedCounter=0;//å°†LEDè¿›åº¦æ¡æ•°ç»„åˆ‡æ¢è®¡æ•°å™¨å½’0
 583   6                              flagBar=0;//LEDè¿›åº¦æ¡åˆæ¬¡æ˜¾ç¤ºæ ‡å¿—å½’0
 584   6                              flagState=1;
 585   6                              /*********èœ‚é¸£å™¨æç¤ºéƒ¨åˆ†*********/
 586   6                              TH1=0xef;
 587   6                              TR0=0;
 588   6                              P0=0;//æ¸…é™¤æ•°ç ç®¡
 589   6                              flagBeep=1;
 590   6                              Delay80ms();
 591   6                              flagBeep=0;
 592   6                              Delay80ms();
 593   6                              flagBeep=1;
 594   6                              Delay80ms();
 595   6                              flagBeep=0;
 596   6                              TR0=1;
 597   6      
 598   6                              sbtIn=1;//ç»§ç”µå™¨è¾“å…¥é«˜ç”µå¹³
 599   6                          }
 600   5                          else
 601   5                          {
 602   6                              flagState=0;
 603   6                              wrongCounter=0;//é”™è¯¯LEDåˆ†é¢‘å½’0
 604   6                              wrongLedCounter=0;//é”™è¯¯LEDé€‰æ‹©å½’0
 605   6                              flagWrong=1;//é”™è¯¯æ ‡å¿—ç½®1
 606   6                              /*********èœ‚é¸£å™¨æç¤ºéƒ¨åˆ†*********/
 607   6                              TH1=0xe5;
 608   6                              TR0=0;
 609   6                              P0=0;
 610   6                              flagBeep=1;
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 11  

 611   6                              Delay500ms();
 612   6                              flagBeep=0;
 613   6                              TR0=1;
 614   6                          }
 615   5                              
 616   5                      }
 617   4                  }
 618   3              }
 619   2              else if(flagState==1)//è§£é”çŠ¶æ€
 620   2              {
 621   3                  if(sbtKey1==0)//æ£€æµ‹åˆ°key1æŒ‰ä¸‹ï¼Œé‡æ–°é”å®š
 622   3                  {
 623   4                      Delay5ms();//æ¶ˆæŠ–
 624   4                      if(sbtKey1==0)//é‡æ–°é”å®š
 625   4                      {
 626   5                          while( !sbtKey1 );//ç›´åˆ°key1æ¾å¼€
 627   5                          for(j=2;j<8;j++)//å°†æ˜¾ç¤ºå¯†ç æ¸…ç©º
 628   5                              pwshow[j]=0;
 629   5                          editBit=2;//ç¼–è¾‘ä½å°æ•°ç‚¹å¤ä½
 630   5                          flagState=0;//æ”¹å›é”å®šçŠ¶æ€
 631   5                          sbtIn=0;//ç»§ç”µå™¨è¾“å…¥ä½ç”µå¹³
 632   5                          flagBar=0;//LEDè¿›åº¦æ¡åˆæ¬¡æ˜¾ç¤ºæ ‡å¿—å½’0
 633   5                          barLedCounter=0;//å°†LEDè¿›åº¦æ¡æ•°ç»„åˆ‡æ¢è®¡æ•°å™¨å½’0
 634   5                          barCounter=0;//å°†LEDè¿›åº¦æ¡åˆ†é¢‘å˜é‡å½’0
 635   5                          //flagBeep=0;
 636   5                          
 637   5                      }
 638   4                  }
 639   3                  if(sbtKey2==0)//æ£€æµ‹åˆ°key2æŒ‰ä¸‹ï¼Œè¿›å…¥ä¿®æ”¹å¯†ç çŠ¶æ€
 640   3                  {
 641   4                      Delay5ms();//æ¶ˆæŠ–
 642   4                      if(sbtKey2==0)
 643   4                      {
 644   5                          while( !sbtKey2 );//ç›´åˆ°key2æ¾å¼€
 645   5                          editBit=2;//ç¼–è¾‘ä½å°æ•°ç‚¹å¤ä½
 646   5                          flagState=2;//è¿›å…¥ä¿®æ”¹å¯†ç çŠ¶æ€
 647   5                          barLedCounter=0;//å°†LEDè¿›åº¦æ¡æ•°ç»„åˆ‡æ¢è®¡æ•°å™¨å½’0
 648   5                          barCounter=0;//å°†LEDè¿›åº¦æ¡åˆ†é¢‘å˜é‡å½’0
 649   5                      }
 650   4                  }
 651   3              }
 652   2              else if(flagState==2)//ä¿®æ”¹çŠ¶æ€
 653   2              {
 654   3                  NavKey_Process();//è·å–å¹¶å¤„ç†å¯¼èˆªæŒ‰é”®çŠ¶æ€
 655   3                  if(sbtKey1==0)//æ£€æµ‹åˆ°key1æŒ‰ä¸‹ï¼Œä¿å­˜ä¿®æ”¹
 656   3                  {
 657   4                      Delay5ms();//æ¶ˆæŠ–
 658   4                      if(sbtKey1==0)
 659   4                      {
 660   5                          while( !sbtKey1 );//ç›´åˆ°key1æ¾å¼€
 661   5                          for(j=2;j<8;j++)//å°†å¯†ç é€ä½å†™å…¥éæ˜“å¤±å­˜å‚¨å™¨
 662   5                          {
 663   6                              write_add(j,pwshow[j]);
 664   6                              Delay10ms();
 665   6                              readPw[j]=pwshow[j];
 666   6                              //pwshow[j]=0x0;
 667   6                          }
 668   5                          flagState=1;//æ”¹å›è§£é”çŠ¶æ€
 669   5                          barLedCounter=8;//å°†LEDè¿›åº¦æ¡æ•°ç»„åˆ‡æ¢è®¡æ•°å™¨å½’0
 670   5                          barCounter=0;//å°†LEDè¿›åº¦æ¡åˆ†é¢‘å˜é‡å½’0
 671   5                      }
 672   4                  }
C51 COMPILER V9.52.0.0   PWLOCK                                                            09/16/2020 23:56:08 PAGE 12  

 673   3                  if (sbtKey2==0)//æ£€æµ‹åˆ°key2æŒ‰ä¸‹ï¼Œä¸ä¿å­˜ä¿®æ”¹
 674   3                  {
 675   4                      Delay5ms();//æ¶ˆæŠ–
 676   4                      if(sbtKey2==0)
 677   4                      {
 678   5                          while( !sbtKey2 );//ç›´åˆ°key1æ¾å¼€
 679   5                          flagState=1;//æ”¹å›è§£é”çŠ¶æ€
 680   5                          barLedCounter=8;//å°†LEDè¿›åº¦æ¡æ•°ç»„åˆ‡æ¢è®¡æ•°å™¨å½’0
 681   5                          barCounter=0;//å°†LEDè¿›åº¦æ¡åˆ†é¢‘å˜é‡å½’0
 682   5                      }
 683   4                  }
 684   3              }
 685   2              else
 686   2              {
 687   3                  flagState=0;
 688   3              }
 689   2          }
 690   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1259    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     59       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
